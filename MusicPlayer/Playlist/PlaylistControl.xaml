<UserControl x:Class="MusicPlayer.Playlist.PlaylistControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MusicPlayer.Playlist"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
  <DockPanel>
    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,2,0,2" Background="{StaticResource DarkInsetPanel}">
      <ToggleButton Name="shuffleToggleButton"
                    ToolTip="Shuffle"
                    IsChecked="{Binding Source={x:Static local:PlaylistManager.Instance}, Path=Shuffle, Mode=TwoWay}"
                    TextBlock.FontSize="22" TextBlock.TextAlignment="Center"
                    Margin="1,2,4,2" Height="34" Width="34">
        <ToggleButton.Style>
          <Style TargetType="{x:Type ToggleButton}" BasedOn="{StaticResource {x:Type ToggleButton}}">
            <Setter Property="Content" Value="⇉"/>
            <Style.Triggers>
              <Trigger Property="IsChecked" Value="True">
                <Setter Property="Content" Value="🔀"/>
              </Trigger>
            </Style.Triggers>
          </Style>
        </ToggleButton.Style>
      </ToggleButton>
      <ToggleButton Name="repeatToggleButton"
                    ToolTip="Repeat"
                    IsChecked="{Binding Source={x:Static local:PlaylistManager.Instance}, Path=Repeat, Mode=TwoWay}"
                    Content="🔁" TextBlock.FontSize="22" TextBlock.TextAlignment="Center"
                    Margin="0,0,0,0" Height="34" Width="34"/>
      <StackPanel Orientation="Horizontal" Margin="4,0,4,0">
        <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
      </StackPanel>
      <Button Name="newPlaylist"
              ToolTip="New Playlist"
              Content="🗋" TextBlock.FontSize="22" TextBlock.TextAlignment="Center"
              Margin="0,0,4,0" Height="33" Width="33"/>
      <Button Name="savePlaylist"
              ToolTip="Save Playlist"
              Content="💾" TextBlock.FontSize="22" TextBlock.TextAlignment="Center" 
              Margin="0,0,4,0" Height="33" Width="33"/>
      <Button Name="loadPlaylist"
              ToolTip="Load Playlist"
              Content="📂" TextBlock.FontSize="22" TextBlock.TextAlignment="Center"
              Margin="0,0,4,0" Height="33" Width="33"/>
      <StackPanel Orientation="Horizontal" Margin="4,0,4,0">
        <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
      </StackPanel>
      <Button Name="tinyViewerButton"
              Content="⟎" TextBlock.FontSize="22" TextBlock.TextAlignment="Center"
              ToolTip="Open Tiny Viewer"
              Margin="0,0,4,0" Height="33" Width="33"/>
    </StackPanel>
    <TreeView ItemsSource="{Binding PlaylistViewModels}">
      <TreeView.ItemContainerStyle>
        <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource {x:Type TreeViewItem}}">
          <EventSetter Event="MouseDoubleClick" Handler="OnItemMouseDoubleClick" />
          <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
          <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
          <Setter Property="FontWeight" Value="Normal" />
          <Style.Triggers>
            <Trigger Property="IsSelected" Value="True">
              <Setter Property="FontWeight" Value="Bold" />
            </Trigger>
            <DataTrigger Binding="{Binding IsDim}" Value="True">
              <Setter Property="TextBlock.Foreground" Value="DimGray"/>
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </TreeView.ItemContainerStyle>

      <TreeView.Resources>
        <HierarchicalDataTemplate DataType="{x:Type local:PlaylistSongViewModel}"
                                            ItemsSource="{Binding Recordings}">
          <StackPanel Orientation="Horizontal">
            <StackPanel.ContextMenu>
              <ContextMenu>
                <MenuItem Header="Play Song" Click="Play"/>
                <MenuItem Header="Remove Song" Click="Remove"/>
                <MenuItem Header="Edit Song Information" Click="Edit"/>
              </ContextMenu>
            </StackPanel.ContextMenu>
            <Border Height="20" Width="7" Padding="1" Background="Black" Margin="0,0,5,0">
              <Rectangle VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                <Rectangle.Fill>
                  <LinearGradientBrush StartPoint="0.5,1.0" EndPoint="0.5,0.0">
                    <GradientStop Color="Green" Offset="0.0"/>
                    <GradientStop Color="Green" Offset="{Binding Path=Weight, FallbackValue=1.0}"/>
                    <GradientStop Color="Red" Offset="{Binding Path=Weight, FallbackValue=1.0}"/>
                    <GradientStop Color="Red" Offset="1.0"/>
                  </LinearGradientBrush>
                </Rectangle.Fill>
              </Rectangle>
            </Border>
            <TextBlock Text="{Binding PlayingString}" VerticalAlignment="Center" MinWidth="20"/>
            <TextBlock Text="{Binding Title}" VerticalAlignment="Center"/>
          </StackPanel>
        </HierarchicalDataTemplate>

        <HierarchicalDataTemplate DataType="{x:Type local:PlaylistRecordingViewModel}">
          <StackPanel Orientation="Horizontal">
            <StackPanel.ContextMenu>
              <ContextMenu>
                <MenuItem Header="Play Recording" Click="Play"/>
                <MenuItem Header="Remove Recording" Click="Remove"/>
                <MenuItem Header="Edit Recording Information" Click="Edit"/>
              </ContextMenu>
            </StackPanel.ContextMenu>
            <Border Height="20" Width="7" Padding="1" Background="Black" Margin="0,0,5,0">
              <Rectangle VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                <Rectangle.Fill>
                  <LinearGradientBrush StartPoint="0.5,1.0" EndPoint="0.5,0.0">
                    <GradientStop Color="Green" Offset="0.0"/>
                    <GradientStop Color="Green" Offset="{Binding Path=Weight, FallbackValue=1.0}"/>
                    <GradientStop Color="Red" Offset="{Binding Path=Weight, FallbackValue=1.0}"/>
                    <GradientStop Color="Red" Offset="1.0"/>
                  </LinearGradientBrush>
                </Rectangle.Fill>
              </Rectangle>
            </Border>
            <TextBlock Text="{Binding PlayingString}" VerticalAlignment="Center" MinWidth="20"/>
            <TextBlock Text="{Binding Title}" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding LiveString}" VerticalAlignment="Center" Margin="5,0,0,0"/>
          </StackPanel>
        </HierarchicalDataTemplate>
      </TreeView.Resources>
    </TreeView>

  </DockPanel>
</UserControl>
